<html>
<head>
  <title>08.CORS</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307425 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1243"/>
<h1>08.CORS</h1>

<div>
<span><div><div style="box-sizing: border-box;"><span style="box-sizing: border-box;"><span style="font-size: 11pt;">CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing），它允许浏览器向跨源服务器发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。</span></span></div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box;"><span style="font-size: 11pt;">CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</span></span></div><div style="box-sizing: border-box; overflow: visible; white-space: normal; text-align: left; background-color: rgb(248, 248, 248); border: 1px solid rgb(223, 226, 229); border-radius: 3px; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; position: relative !important;"><div style="font-size: 0.9em;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">1.Access-Control-Allow-Origin</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    header('Access-Control-Allow-Origin: * ');  </font></span></div><div><font style="font-size: 11pt;"><span style="font-family: Consolas; color: rgb(51, 51, 51);">该字段是必须的。需要在后端响应头添加词字段，值要么是一个*，表示接受任意域名的请求，要么指定一个域名</span><a href="http://localhost/" style="font-family: Consolas; color: rgb(51, 51, 51);">http://localhost</a><span style="font-family: Consolas; color: rgb(51, 51, 51);">。</span></font></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">2.Access-Control-Allow-Methods</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">3.Access-Control-Allow-Headers</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    header('Access-Control-Allow-Methods:POST');  </font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    header('Access-Control-Allow-Headers:x-requested-with,content-type');</font></span></div></div></div><h6 style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; margin-top: 1rem; margin-bottom: 1rem; cursor: text; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; cursor: text; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-after: avoid-page; break-inside: avoid; color: rgb(119, 119, 119); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.4;">案例：天气预报</span></h6><div style="box-sizing: border-box; overflow: visible; white-space: normal; text-align: left; background-color: rgb(248, 248, 248); border: 1px solid rgb(223, 226, 229); border-radius: 3px; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; position: relative !important;"><div style="font-size: 0.9em;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">//1.直接利用ajax请求得到数据</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">let xhr = new XMLHttpRequest();</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">let status = [200,304]</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">xhr.onload = function(){</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    if(status.includes(xhr.status)){</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        let res = JSON.parse(xhr.responseText)</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        console.log(res.data);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        //拿到数据，可以渲染部分到页面上</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        let title = document.createElement('h2');</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        title.innerHTML = res.data.city + '天气预报';</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        let tips = document.createElement('p');</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        tips.innerHTML = res.data.ganmao;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        let ul = document.createElement('ul');</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        ul.innerHTML = res.data.forecast.map(item=&gt;{</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">            return `&lt;li&gt;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">                &lt;h4&gt;${item.date}&lt;/h4&gt;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">                &lt;p&gt;${item.low} / ${item.high}&lt;/p&gt;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">                &lt;p class=&quot;type&quot;&gt;${item.type}&lt;/p&gt;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">            &lt;/li&gt;`</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        }).join('\n');</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        // 清空内容</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        weather.innerHTML = '';</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        weather.appendChild(title);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        weather.appendChild(tips);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        weather.appendChild(ul);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    }</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">}</font></span></div><div><font style="font-size: 11pt;"><span style="font-family: Consolas; color: rgb(51, 51, 51);">xhr.open('get','</span><a href="http://wthrcdn.etouch.cn/weather_mini?city=" style="font-family: Consolas; color: rgb(51, 51, 51);">http://wthrcdn.etouch.cn/weather_mini?city=</a><span style="font-family: Consolas; color: rgb(51, 51, 51);">广州',true);</span></font></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">xhr.send();</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">//2.配合文本框实现，得到不同城市的天气预报</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">city.onblur = function(){</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    let _city = city.value.trim();</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    if(_city.length === 0){</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        return;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    }</font></span></div><div><font style="font-size: 11pt;"><span style="font-family: Consolas; color: rgb(51, 51, 51);">    xhr.open('get','</span><a href="http://wthrcdn.etouch.cn/weather_mini?city='+_city,true);" style="font-family: Consolas; color: rgb(51, 51, 51);">http://wthrcdn.etouch.cn/weather_mini?city='+_city,true);</a></font></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    xhr.send();</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">}</font></span></div></div></div><h6 style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; margin-top: 1rem; margin-bottom: 1rem; cursor: text; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; cursor: text; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-after: avoid-page; break-inside: avoid; color: rgb(119, 119, 119); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.4;">演示：百度地图</span></h6></div><div><br/></div></span>
</div></body></html> 