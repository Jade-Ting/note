<html>
<head>
  <title>06.JSON</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307425 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="871"/>
<h1>06.JSON</h1>

<div>
<span><div><div><font style="font-size: 14pt;"><b>格式</b></font></div><ul><li><div><font style="font-size: 11pt;">属性名额字符串必须使用双引号</font></div></li><li><div><font style="font-size: 11pt;">不能有注释</font></div></li><li><div><font style="font-size: 11pt;">不能存在多余逗号</font></div></li></ul><div><font style="font-size: 14pt;"><b>转换</b></font></div><ul><li><div><font style="font-size: 11pt;">对象/数组 -&gt; json字符串：JSON.stringify()</font></div></li><li><div><font style="font-size: 11pt;">json字符串 -&gt; 对象/数组：JSON.parse()</font></div></li></ul><div><br/></div><div><font style="font-size: 14pt;"><b>属性值必须为以下类型</b></font></div><ul><li><div>  <font style="font-size: 11pt;">  String</font></div></li><li><div><font style="font-size: 11pt;">    Number</font></div></li><li><div><font style="font-size: 11pt;">    Boolean</font></div></li><li><div><font style="font-size: 11pt;">    Object</font></div></li><li><div><font style="font-size: 11pt;">    Array</font></div></li><li><div><font style="font-size: 11pt;">    Null</font></div></li></ul><div><br/></div><div style="box-sizing: border-box;"><span style="box-sizing: border-box;"><font style="font-size: 14pt;"><b><font>案例</font>：将商品添加到购物车列表</b></font></span></div><div style="box-sizing: border-box; overflow: visible; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; white-space: normal; text-align: left; break-inside: avoid; background-color: rgb(248, 248, 248); border: 1px solid rgb(223, 226, 229); border-radius: 3px; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; position: relative !important;"><div style="font-size: 0.9em;"><br/></div><div><span style="box-sizing: border-box;"><font style="font-size: 11pt;">// 3.每次刷新，拿到上一次的存放值。第一次是为空数组</font></span></div><div><span style="box-sizing: border-box;"><font style="font-size: 11pt;">// * 若已经存在值，默认为JSON字符串，要转回数组</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">var goodslist = Cookie.get('goodslist') || [];</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">if(typeof goodslist === 'string'){</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">goodslist = JSON.parse(goodslist);</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">}</font></span></div><div><span style="box-sizing: border-box;"><font style="font-size: 11pt;">// 1.利用事件委托实现添加到购物车的效果</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">goods.onclick = function(e){</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">e = e || window.event;</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">var target = e.target || e.srcElement;</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">if(target.parentNode.className === 'add2cart'){</font></span></div><div><span style="box-sizing: border-box;"><font style="font-size: 11pt;">// 2.若当前为按钮被点击</font></span></div><div><span style="box-sizing: border-box;"><font style="font-size: 11pt;">// （1）生成一个商品信息对象{guid，name，imgurl，price，qty（商品数量）}</font></span></div><div><span style="box-sizing: border-box;"><font style="font-size: 11pt;">// （2）推入数组，将数组添加到cookie里面</font></span></div><div><span style="box-sizing: border-box;"><font style="font-size: 11pt;">// （3）考虑如果商品信息已经添加过，则应该增加数组里面的该商品数量</font></span></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box;">//</span> <span style="box-sizing: border-box;">* 第一步:判断当前的guid是否在数组存在。</span></font></div><div><span style="box-sizing: border-box;"><font style="font-size: 11pt;">// * 第二步:若存在，拿到该商品信息在数组中的索引，利用索引将qty++</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">var currentLi = target.parentNode.parentNode;</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">var guid = currentLi.getAttribute('data-guid');</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">var idx;</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">var has = goodslist.some(function(g,i){</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">idx = i;</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">return g.guid === guid;</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">});</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">if(has){</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">goodslist[idx].qty++;</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">}else{</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">var goods = {</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">guid:guid,</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">name:currentLi.children[1].innerText,</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">imgurl:currentLi.children[0].src,</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">price:currentLi.children[2].innerText,</font></span></div><div><span style="box-sizing: border-box;"><font style="font-size: 11pt;">// 商品数量</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">qty:1</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">}</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">goodslist.push(goods);</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">}</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">document.cookie = 'goodslist='+ JSON.stringify(goodslist);</font></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><font style="font-size: 11pt;">}</font></span></div></div><div><br/></div></div></span>
</div></body></html> 