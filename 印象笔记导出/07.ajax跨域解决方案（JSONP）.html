<html>
<head>
  <title>07.ajax跨域解决方案（JSONP）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307425 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1241"/>
<h1>07.ajax跨域解决方案（JSONP）</h1>

<div>
<span><div><h3 style="box-sizing: border-box; orphans: 2; font-size: 1.5em; position: relative; margin-top: 1rem; margin-bottom: 1rem; cursor: text; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; orphans: 2; font-size: 1.5em; position: relative; cursor: text; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-after: avoid-page; break-inside: avoid; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.43;">JSONP</span></h3><ul style="box-sizing: border-box; margin: 0.8em 0px; padding-left: 30px; position: relative; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><li style="box-sizing: border-box; margin: 0px; position: relative;"><div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px 0px 0.5rem; position: relative; width: inherit;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-caps: normal; font-variant-ligatures: normal;">JSONP 是JSON with padding（填充式JSON 或参数式JSON）的简写。</span></div></div></li><li style="box-sizing: border-box; margin: 0px; position: relative;"><div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px 0px 0.5rem; position: relative; width: inherit;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-caps: normal; font-variant-ligatures: normal;">JSONP是一种可以绕过浏览器的安全限制，从不同的域请求数据的方法。</span></div></div></li><li style="box-sizing: border-box; margin: 0px; position: relative;"><div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px 0px 0.5rem; position: relative; width: inherit;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-caps: normal; font-variant-ligatures: normal;">JSONP请求不是ajax请求，是利用script标签能加载其他域名的js文件的原理，来实现跨域数据的请求</span></div></div></li><li style="box-sizing: border-box; margin: 0px; position: relative;"><div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px 0px 0.5rem; position: relative; width: inherit;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-caps: normal; font-variant-ligatures: normal;">局限性：</span></div></div></li><ul style="box-sizing: border-box; margin: 0px; padding-left: 30px; position: relative;"><li style="box-sizing: border-box; margin: 0px; position: relative;"><div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px 0px 0.5rem; position: relative; width: inherit;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-caps: normal; font-variant-ligatures: normal;">只能为get请求</span></div></div></li><li style="box-sizing: border-box; margin: 0px; position: relative;"><div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px 0px 0.5rem; position: relative; width: inherit;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-caps: normal; font-variant-ligatures: normal;">接口必须有回调函数的执行</span></div></div></li></ul></ul><h6 style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; margin-top: 1rem; margin-bottom: 1rem; cursor: text; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; cursor: text; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-after: avoid-page; break-inside: avoid; color: rgb(119, 119, 119); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.4;">演示：使用script标签其他js文件调用本地js的某个函数</span></h6><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">//html页面：</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">&lt;script type=&quot;text/javascript&quot;&gt;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    function sum(n){</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        console.log(n);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    }</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">&lt;/script&gt;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">&lt;script type=&quot;text/javascript&quot; src=&quot;../js/common.js&quot;&gt;&lt;/script&gt;</font></span></div><div><font style="font-size: 11pt;"><br style="font-family: Consolas; color: rgb(51, 51, 51);"/></font></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">//common.js代码</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">sum(6666);</font></span></div><div><font style="font-size: 11pt;"><br style="font-family: Consolas; color: rgb(51, 51, 51);"/></font></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">//此时html页面的控制台打印 6666。</font></span></div></div><div style="box-sizing: border-box; overflow: visible; font-size: 0.9em; white-space: normal; text-align: left; background-color: rgb(248, 248, 248); border: 1px solid rgb(223, 226, 229); border-radius: 3px; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; position: relative !important;"><br/></div><h6 style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; margin-top: 1rem; margin-bottom: 1rem; cursor: text; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; cursor: text; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-after: avoid-page; break-inside: avoid; color: rgb(119, 119, 119); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.4;">演示：使用script标签其他php文件调用本地js的未知名方法，返回数据</span></h6><div style="box-sizing: border-box; overflow: visible; white-space: normal; text-align: left; background-color: rgb(248, 248, 248); border: 1px solid rgb(223, 226, 229); border-radius: 3px; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; position: relative !important;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">//html页面：</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">&lt;script type=&quot;text/javascript&quot;&gt;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    function sum(data){</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        console.log(data);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    }</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    function sum2(data){</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        alert(data);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    }</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">&lt;/script&gt;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">&lt;script src=&quot;../api/lemon.php?callback=函数名&quot;&gt;&lt;/script&gt;</font></span></div><div><font style="font-size: 11pt;"><br style="font-family: Consolas; color: rgb(51, 51, 51);"/></font></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">//php文件：</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">&lt;?php</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    $fn = $_GET[&quot;callback&quot;];</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    echo &quot;$fn(数据)&quot;;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">?&gt;</font></span></div></div></div><h6 style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; margin-top: 1rem; margin-bottom: 1rem; cursor: text; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; cursor: text; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-after: avoid-page; break-inside: avoid; color: rgb(119, 119, 119); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.4;">案例：利用JSONP原理调用百度建议</span></h6><div style="box-sizing: border-box; overflow: visible; white-space: normal; text-align: left; background-color: rgb(248, 248, 248); border: 1px solid rgb(223, 226, 229); border-radius: 3px; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; position: relative !important;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">msg.oninput = function(){</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    let _msg = msg.value;</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    clearTimeout(timer);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    timer = setTimeout(()=&gt;{</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    let script = document.createElement('script');</font></span></div><div><font style="font-size: 11pt;"><span style="font-family: Consolas; color: rgb(51, 51, 51);">    script.src='</span><a href="https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/sujson=1%26cb=getData%26wd='+_msg;" style="font-family: Consolas; color: rgb(51, 51, 51);">https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/sujson=1&amp;cb=getData&amp;wd='+_msg;</a></font></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    document.body.appendChild(script);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    },500);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">}</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">window.getData = function(data){</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    suggest.innerHTML = data.s.map(item=&gt;{</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        return `&lt;li&gt;${item}&lt;/li&gt;`</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">        }).join(&quot;&quot;);</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">    }</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">})</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">//原理性代码：</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">//1.script的src中回调函数的传递</font></span></div><div><font style="font-size: 11pt;"><span style="font-family: Consolas; color: rgb(51, 51, 51);">script.src='</span><a href="https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/sujson=1%26cb=getData%26wd='+_msg;" style="font-family: Consolas; color: rgb(51, 51, 51);">https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/sujson=1&amp;cb=getData&amp;wd='+_msg;</a></font></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">//2.声明全局函数</font></span></div><div><span style="font-family: Consolas; color: rgb(51, 51, 51);"><font style="font-size: 11pt;">window.getData = function(data){处理数据}</font></span></div></div></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 