<html>
<head>
  <title>07.延迟与定时器</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307425 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="903"/>
<h1>07.延迟与定时器</h1>

<div>
<span><div><ul style="box-sizing: border-box; margin: 0.8em 0px; padding-left: 30px; position: relative; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><li style="box-sizing: border-box; margin: 0px; position: relative;"><div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px 0px 0.5rem; position: relative; width: inherit;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-caps: normal; font-variant-ligatures: normal;">setTimeout(fn,200)：两百毫秒后执行fn这个函数（只执行一次）,返回一个id标识</span></div></div></li><li style="box-sizing: border-box; margin: 0px; position: relative;"><div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px 0px 0.5rem; position: relative; width: inherit;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-caps: normal; font-variant-ligatures: normal;">clearTimeout(timeoutID)：清除指定id标识的延迟操作</span></div></div></li><li style="box-sizing: border-box; margin: 0px; position: relative;"><div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px 0px 0.5rem; position: relative; width: inherit;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-caps: normal; font-variant-ligatures: normal;">setInterval(fn,30)：每隔30毫秒执行一次fn这个函数,返回一个id标识</span></div></div></li><li style="box-sizing: border-box; margin: 0px; position: relative;"><div><p style="box-sizing: border-box; orphans: 4; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px 0px 0.5rem; position: relative; width: inherit;"></p><div style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-caps: normal; font-variant-ligatures: normal;">clearInterval(intervalID)：清除指定id标识的定时器操作</span></div></div></li></ul><div style="box-sizing: border-box;">&lt;注意：关于声明提前的问题，在函数内清除定时器，记得将定时器声明放在函数外&gt;</div><div style="box-sizing: border-box; overflow: visible; white-space: normal; text-align: left; background-color: rgb(248, 248, 248); border: 1px solid rgb(223, 226, 229); border-radius: 3px; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; position: relative !important;"><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">var timer = setTimeout(function(){</span></span></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">//2s后执行这里的代码</span></font></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">},2000);</span></span></div><div><br/></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">//清除</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">clearTimeout(timer);</span></span></div></div><h6 style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; margin-top: 1rem; margin-bottom: 1rem; cursor: text; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; cursor: text; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-after: avoid-page; break-inside: avoid; color: rgb(119, 119, 119); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.4;">案例：实现进度条</span></h6><div style="box-sizing: border-box; overflow: visible; white-space: normal; text-align: left; background-color: rgb(248, 248, 248); border: 1px solid rgb(223, 226, 229); border-radius: 3px; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; position: relative !important;"><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">// 1.进度条变量初始宽度</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">var width = 0;</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">// 2.进度条变量宽度每隔一段时间，递增一定的值</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">var timer = setInterval(function(){</span></span></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">width += 13;</span></font></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">// 3.当进度条变量宽度大于浏览器可视区域宽度，停止定时器，赋值为浏览器可视区域的宽度</span></font></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">if(width &gt;= window.innerWidth){//333,366</span></font></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">width = window.innerWidth;</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">clearInterval(timer)</span></span></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">}</span></font></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">// 4.将进度条变量的值，赋值给进度条样式</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">bar.style.width = width + 'px';</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt;">},30);</span></span></div></div><h6 style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; margin-top: 1rem; margin-bottom: 1rem; cursor: text; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; orphans: 2; font-size: 1em; position: relative; cursor: text; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-after: avoid-page; break-inside: avoid; color: rgb(119, 119, 119); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.4;">案例：实现倒计时</span></h6><div style="box-sizing: border-box; overflow: visible; white-space: normal; text-align: left; background-color: rgb(248, 248, 248); border: 1px solid rgb(223, 226, 229); border-radius: 3px; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; position: relative !important;"><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">1）指定结束时间</span></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box; break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">var end = '2018-3-1 14:50:40';</span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">2）定时器，每秒拿当前时间跟结束时间对比，计算差值</span></span></div><div style="margin-left: 40px;"><font style="font-size: 11pt;"><span style="box-sizing: border-box; break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">var offset = Date.parse(end) - Date.now();</span></font></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">3）把差值转换成《剩余时间》</span></span></div><div style="margin-left: 40px;"><font style="font-size: 11pt;"><span style="box-sizing: border-box; break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">offset = Math.floor(offset/1000);</span></font></div><div style="margin-left: 40px;"><font style="font-size: 11pt;"><span style="box-sizing: border-box; break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">var sec = offset%60;//50,5</span></font></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">var min = Math.floor(offset/60)%60;</span></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">var hour = Math.floor(offset/60/60)%24;</span></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">var day = Math.floor(offset/60/60/24);</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">// 补0操作</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">4）拼接时间格式，写入页面</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">5）倒计时结束时（应写在步骤3前面，不再呈现在页面上）</span></span></div><div style="margin-left: 40px;"><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">if(offset &lt;= 0){</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(255, 175, 0); font-size: 11pt;">// 停止定时器</span></span></div><div><span style="box-sizing: border-box;"><span style="break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(255, 175, 0); font-size: 11pt;">// 替换购买按钮</span></span></div><div><font color="#FFAF00" style="font-size: 11pt;"><span style="box-sizing: border-box; break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(255, 175, 0); font-size: 11pt;">// *隐藏倒计时</span></font></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; break-inside: avoid; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51); font-size: 11pt;">}</span></font></div></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 